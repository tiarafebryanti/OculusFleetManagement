<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>OCULUS FLEET | GTEI Tugboat Fleet Management</title>
    <meta
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
      name="viewport"
    />
    <link rel="icon" href="assets/img/examples/logo-oculus.png" type="image/x-icon" />

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- CSS Files -->
    <link
      id="pagestyle"
      href="../assets/css/argon-dashboard.css?v=2.1.0"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin=""
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      #map {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 100vw;
        z-index: -1;
      }

      .profile-badge {
        background-color: #ffffff; /* putih */
        border-radius: 999px;
        border: 2px solid #1a1a1a;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      /* Modal styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        position: relative;
        width: 90%;
        max-width: 800px;
      }

      .modal video {
        width: 100%;
        height: auto;
        border-radius: 4px;
      }

      .close-btn {
        position: absolute;
        top: -16px;
        right: -16px;
        background: red;
        color: white;
        font-size: 20px;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        cursor: pointer;
      }

      .leaflet-control-zoom {
        margin-left: 300px !important;
        margin-top: 30px !important;
      }

      .leaflet-control-layers {
        background: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        border-radius: 8px;
        margin-left: 293px !important;
      }

      .sidebar {
        position: absolute;
        top: 105px;
        right: 20px;
        width: 350px;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 999;
      }

      .fleet-card {
        display: flex;
        background: #e4e4e4;
        padding: 10px 18px;
        margin-bottom: 10px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        align-items: center;
      }

      .fleet-icon img {
        width: 70px;
        height: 40px;
        margin-right: 12px;
      }

      .fleet-details {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }

      .fleet-header {
        display: flex;
        justify-content: space-between;
        font-weight: 600;
        color: #3a3a3a;
        margin-bottom: 5px;
      }

      .fleet-title {
        font-size: 15px;
        color: #000000;
      }

      .fleet-online {
        color: green;
        font-size: 14px;
      }

      .fleet-info-line {
        display: flex;
        justify-content: space-between;
        color: #4f4f4f;
        font-size: 16px;
        padding: 8px 0;
      }

      .highlight {
        background-color: #cfe8ff !important;
      }

      .search-bar {
        margin-bottom: 15px;
      }

      .search-bar input {
        width: 100%;
        padding: 12px;
        border-radius: 25px;
        border: 2px solid #ccc;
        font-size: 16px;
      }

      .search-bar input:focus {
        outline: none;
        box-shadow: none;
        border-color: #ccc; /* Tetap warna abu-abu saat fokus */
      }

      .tugboat-list {
        max-height: 450px; /* Sesuaikan tinggi maksimum sesuai kebutuhan */
        overflow-y: auto;
      }
    </style>
  </head>

  <body class="g-sidenav-show bg-gray-100">
    <!-- Map Background -->
    <div id="map"></div>

    <aside
      class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4"
      id="sidenav-main"
      style="background-color: #22283b"
    >
      <div class="sidenav-header mt-4">
        <i
          class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
          aria-hidden="true"
          id="iconSidenav"
        ></i>
        <a class="navbar-brand m-0" href="" target="_blank">
          <div class="d-flex justify-content-center">
            <img
              src="assets/img/examples/logo-oculus.png"
              class="navbar-brand-img"
              alt="main_logo"
              style="
                width: 100%;
                height: auto;
                max-height: 250px;
                object-fit: contain;
              "
            />
          </div>
        </a>
      </div>
      <hr class="horizontal dark mt-0" />
      <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
        <ul class="navbar-nav">
          <li class="nav-item" style="margin-bottom: 16px">
            <a class="nav-link active" href="../pages/dashboard.html">
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-th-large active opacity-10"
                  style="font-size: 23px; color: #22283b"
                ></i>
              </div>
              <span class="nav-link-text ms-1" style="font-size: 23px"
                >Dashboard</span
              >
            </a>
          </li>
          <li class="nav-item" style="margin-bottom: 16px">
            <a class="nav-link" href="pages/tripsummary.html">
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-window-maximize opacity-10"
                  style="font-size: 23px"
                ></i>
              </div>
              <span class="nav-link-text ms-1" style="font-size: 23px"
                >Trip Summary</span
              >
            </a>
          </li>
          <li class="nav-item" style="margin-bottom: 16px">
            <a class="nav-link" href="pages/configuration.html">
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-sliders-h opacity-10"
                  style="font-size: 23px"
                ></i>
              </div>
              <span class="nav-link-text ms-1" style="font-size: 23px"
                >Configuration</span
              >
            </a>
          </li>
          <li class="nav-item" style="margin-bottom: 16px">
            <a class="nav-link" href="pages/schedule.html">
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-calendar-days opacity-10"
                  style="font-size: 23px"
                ></i>
              </div>
              <span class="nav-link-text ms-1" style="font-size: 23px"
                >Schedule</span
              >
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="pages/sign-up.html">
              <div
                class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center"
              >
                <i
                  class="fas fa-right-from-bracket opacity-10"
                  style="font-size: 23px"
                ></i>
              </div>
              <span class="nav-link-text ms-1" style="font-size: 23px"
                >Logout</span
              >
            </a>
          </li>
        </ul>
      </div>
    </aside>

    <main class="main-content position-relative border-radius-lg">
      <!-- Navbar -->
      <nav
        class="navbar navbar-main navbar-expand-lg px-0 shadow-none border-radius-xl"
        id="navbarBlur"
        data-scroll="false"
      >
        <div class="container-fluid py-1 px-3">
          <div
            class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4"
            id="navbar"
          >
            <div
              class="ms-md-auto pe-md-3 d-flex align-items-center position-relative"
            >
              <input
                type="text"
                class="form-control text-white text-lg pe-3"
                placeholder="Type here..."
                style="
                  background-color: #22283b;
                  border-radius: 999px;
                  border: none;
                  padding-top: 0.875rem;
                  padding-bottom: 0.875rem;
                "
              />
              <i
                class="fas fa-search position-absolute"
                style="right: 30px; color: white"
              ></i>
            </div>

            <div class="profile-badge">
              <div class="badge-content d-flex align-items-center px-4">
                <div class="profile-icon me-2">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="32"
                    viewBox="0 0 24 24"
                    width="32"
                    fill="#666"
                  >
                    <path d="M0 0h24v24H0z" fill="none" />
                    <path
                      d="M12 12c2.7 0 4.9-2.2 4.9-4.9S14.7 2.2 12 2.2 7.1 4.4 7.1 7.1 9.3 12 12 12zm0 2c-3.3 0-9.8 1.7-9.8 5v2h19.6v-2c0-3.3-6.5-5-9.8-5z"
                    />
                  </svg>
                </div>
                <div class="profile-text">
                  <div style="font-weight: 600; color: #333">Jane Doe</div>
                  <div style="font-size: 0.9em; color: #888">Admin</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

      <div class="sidebar">
        <div class="search-bar">
          <div class="mb-3">
            <input
              type="text"
              class="form-control border-radius-2xl border-2"
              placeholder="by Nomor Kendaraan / ID"
            />
          </div>
        </div>
        <div class="d-flex flex-column tugboat-list">
          <!-- Fleet cards will be inserted dynamically -->
        </div>
        <p id="record-info" class="text-start mt-2">
          <small>7 records found</small><br /><strong>of 7 Tugboats</strong>
        </p>
      </div>

      <div
        style="
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: calc(100% - 40px);
          max-width: 1200px;
          z-index: 999;
        "
      >
        <div style="margin-bottom: 10px">
          <select
            id="tugboat-select"
            style="
              padding: 10px 16px;
              border-radius: 4px;
              border: 1px solid #ccc;
              width: 285px;
              font-size: 16px;
              font-family: 'Poppins', sans-serif;
              background: white;
              color: #4b4b4b;
            "
          >
            <option value="">Pilih Tugboat</option>
          </select>
        </div>

        <!-- Video Grid -->
        <div
          class="video-grid"
          style="display: flex; flex-wrap: wrap; gap: 16px"
        >
          <div style="flex: 1; min-width: 220px">
            <div
              style="position: relative"
              onclick="zoomVideo('https://www.w3schools.com/html/mov_bbb.mp4', 'Front Cam')"
            >
              <div
                style="
                  position: absolute;
                  top: 8px;
                  left: 8px;
                  background: #22283b;
                  color: white;
                  padding: 4px 8px;
                  border-radius: 4px;
                  font-size: 14px;
                  font-family: 'Poppins', sans-serif;
                "
              >
                Front Cam
              </div>
              <iframe
                width="100%"
                height="180"
                src="https://www.youtube.com/embed/6giEyn-GPEQ?autoplay=1&mute=1"
                title="Front Cam"
                frameborder="0"
                allow="autoplay; encrypted-media"
                allowfullscreen
                style="border-radius: 8px"
              >
              </iframe>
            </div>
          </div>

          <div style="flex: 1; min-width: 220px">
            <div
              style="position: relative"
              onclick="zoomVideo('https://www.w3schools.com/html/mov_bbb.mp4', 'Rear Cam')"
            >
              <div
                style="
                  position: absolute;
                  top: 8px;
                  left: 8px;
                  background: #22283b;
                  color: white;
                  padding: 4px 8px;
                  border-radius: 4px;
                  font-size: 14px;
                  font-family: 'Poppins', sans-serif;
                "
              >
                Rear Cam
              </div>
              <iframe
                width="100%"
                height="180"
                src="https://www.youtube.com/embed/6giEyn-GPEQ?autoplay=1&mute=1"
                title="Front Cam"
                frameborder="0"
                allow="autoplay; encrypted-media"
                allowfullscreen
                style="border-radius: 8px"
              >
              </iframe>
            </div>
          </div>

          <div style="flex: 1; min-width: 220px">
            <div
              style="position: relative"
              onclick="zoomVideo('https://www.w3schools.com/html/mov_bbb.mp4', 'Bridge Cam')"
            >
              <div
                style="
                  position: absolute;
                  top: 8px;
                  left: 8px;
                  background: #22283b;
                  color: white;
                  padding: 4px 8px;
                  border-radius: 4px;
                  font-size: 14px;
                  font-family: 'Poppins', sans-serif;
                "
              >
                Bridge Cam
              </div>
              <iframe
                width="100%"
                height="180"
                src="https://www.youtube.com/embed/6giEyn-GPEQ?autoplay=1&mute=1"
                title="Front Cam"
                frameborder="0"
                allow="autoplay; encrypted-media"
                allowfullscreen
                style="border-radius: 8px"
              >
              </iframe>
            </div>
          </div>

          <div style="flex: 1; min-width: 220px">
            <div
              style="position: relative"
              onclick="zoomVideo('https://www.w3schools.com/html/mov_bbb.mp4', 'Engine Room')"
            >
              <div
                style="
                  position: absolute;
                  top: 8px;
                  left: 8px;
                  background: #22283b;
                  color: white;
                  padding: 4px 8px;
                  border-radius: 4px;
                  font-size: 14px;
                  font-family: 'Poppins', sans-serif;
                "
              >
                Engine Room
              </div>
              <iframe
                width="100%"
                height="180"
                src="https://www.youtube.com/embed/6giEyn-GPEQ?autoplay=1&mute=1"
                title="Front Cam"
                frameborder="0"
                allow="autoplay; encrypted-media"
                allowfullscreen
                style="border-radius: 8px"
              >
              </iframe>
            </div>
          </div>
        </div>

        <!-- Modal Zoom -->
        <div class="modal" id="videoModal">
          <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">×</button>
            <video id="modalVideo" src="" controls autoplay></video>
          </div>
        </div>
      </div>
    </main>

    <script>
      function zoomVideo(videoSrc, label) {
        const modal = document.getElementById("videoModal");
        const modalVideo = document.getElementById("modalVideo");
        modal.style.display = "flex";
        modalVideo.src = videoSrc;
        modalVideo.play();
      }

      function closeModal() {
        const modal = document.getElementById("videoModal");
        const modalVideo = document.getElementById("modalVideo");
        modalVideo.pause();
        modalVideo.src = "";
        modal.style.display = "none";
      }

      // Close modal if clicked outside content
      window.onclick = function (event) {
        const modal = document.getElementById("videoModal");
        if (event.target === modal) {
          closeModal();
        }
      };
    </script>

    <!--   Core JS Files   -->
    <script src="../assets/js/core/popper.min.js"></script>
    <script src="../assets/js/core/bootstrap.min.js"></script>

    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      crossorigin=""
    ></script>

    <script>
      const apiKey = "46e83f19b2e3244bbe77f80885ca3c2b";
      const map = L.map("map").setView([-3.1, 114.65], 9);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      // Weather overlay layers
      const clouds = L.tileLayer(
        `https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${apiKey}`,
        {
          opacity: 1.0,
          attribution:
            '&copy; <a href="https://openweathermap.org/">OpenWeatherMap</a>',
        }
      );

      const precipitation = L.tileLayer(
        `https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${apiKey}`,
        {
          opacity: 1.0,
        }
      );

      const rain = L.tileLayer(
        `https://tile.openweathermap.org/map/rain_new/{z}/{x}/{y}.png?appid=${apiKey}`,
        {
          opacity: 1.0,
        }
      );

      const snow = L.tileLayer(
        `https://tile.openweathermap.org/map/snow_new/{z}/{x}/{y}.png?appid=${apiKey}`,
        {
          opacity: 1.0,
        }
      );

      const temp = L.tileLayer(
        `https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${apiKey}`,
        {
          opacity: 0.5,
        }
      );

      const wind = L.tileLayer(
        `https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=${apiKey}`,
        {
          opacity: 1.0,
        }
      );

      // Layer Groups
      const overlays = {
        Clouds: clouds,
        Precipitation: precipitation,
        Rain: rain,
        Snow: snow,
        Temperature: temp,
        Wind: wind,
      };

      L.control
        .layers(null, overlays, {
          collapsed: true,
          position: "topleft", // atau "topleft", "topright", "bottomright"
        })
        .addTo(map);

      const tugboats = [
        {
          id: "TUGBOAT GTEI 1",
          image: "assets/img/examples/tugboat.png",
          status: "Moving",
          speed: "3.5 Knots",
          heading: "190",
          coords: [-2.979758, 114.770769],
        },
        {
          id: "TUGBOAT GTEI 2",
          image: "assets/img/examples/tugboat.png",
          status: "Moving",
          speed: "3.5 Knots",
          heading: "190",
          coords: [-3.28953, 114.56758],
        },
        {
          id: "TUGBOAT GTEI 3",
          image: "assets/img/examples/tugboat.png",
          status: "Moving",
          speed: "3.5 Knots",
          heading: "190",
          coords: [-3.40984, 114.49331],
        },
        {
          id: "TUGBOAT GTEI 4",
          image: "assets/img/examples/tugboat.png",
          status: "Moving",
          speed: "3.5 Knots",
          heading: "190",
          coords: [-3.6818, 114.4418],
        },
        {
          id: "TUGBOAT GTEI 5",
          image: "assets/img/examples/tugboat.png",
          status: "Moving",
          speed: "3.5 Knots",
          heading: "190",
          coords: [-10.17422, 123.622091],
        },
        {
          id: "TUGBOAT GTEI 6",
          image: "assets/img/examples/tugboat.png",
          status: "Moving",
          speed: "3.5 Knots",
          heading: "190",
          coords: [-6.2711281704409245, 107.65769652872076],
        },
        {
          id: "TUGBOAT GTEI 7",
          image: "assets/img/examples/tugboat.png",
          status: "Moving",
          speed: "3.5 Knots",
          heading: "190",
          coords: [-7.789476, 110.396235],
        },
      ];

      const cardContainer = document.querySelector(".d-flex.flex-column");

      // Buat fleet card dan simpan semua marker
      const markers = [];

      const customIcon = L.icon({
        iconUrl: "assets/img/examples/tugboat.png",
        iconSize: [50, 35],
        iconAnchor: [20, 20],
        popupAnchor: [0, -20],
      });

      function renderFleetCards() {
        tugboats.forEach((tugboat) => {
          const card = document.createElement("div");
          card.classList.add("fleet-item");
          card.innerHTML = `
      <div class="fleet-card ">
    <div class="fleet-icon">
      <img src="${tugboat.image}" alt="Tugboat Icon" />
    </div>
    <div class="fleet-details">
      <div class="fleet-header">
        <span class="fleet-title">${tugboat.id}</span>
        <span class="fleet-online">Online</span>
      </div>
      <div class="fleet-info-line">Status <span>${tugboat.status}</span></div>
      <div class="fleet-info-line">Speed <span>${tugboat.speed}</span></div>
      <div class="fleet-info-line">Heading <span>${tugboat.heading}</span></div>
    </div>
  </div>
    `;
          cardContainer.appendChild(card);

          const marker = L.marker(tugboat.coords, { icon: customIcon }).addTo(
            map
          ).bindPopup(`
      <div style="text-align:center">
        <img src="${tugboat.image}" alt="tugboat" style="width:60px;"><br>
        <strong>${tugboat.id}</strong><br>
        <small>${tugboat.status}</small><br>
        <small>${tugboat.speed}</small><br>
        <small>${tugboat.heading}</small><br>
      </div>
    `);
          markers.push({ id: tugboat.id, marker, card });
        });
      }

      function populateSelectDropdown() {
        const select = document.getElementById("tugboat-select");
        tugboats.forEach((tugboat) => {
          const option = document.createElement("option");
          option.value = tugboat.id;
          option.textContent = tugboat.id;
          select.appendChild(option);
        });
      }

      renderFleetCards();
      populateSelectDropdown();

      const inputElement = document.querySelector(
        'input[placeholder="by Nomor Kendaraan / ID"]'
      );

      inputElement.addEventListener("input", function () {
        const searchTerm = this.value.trim().toUpperCase();

        // Hapus semua marker
        markers.forEach((item) => {
          map.removeLayer(item.marker);
          const fleetCard = item.card.querySelector(".fleet-card");
          fleetCard.classList.remove("highlight");
        });

        if (searchTerm === "") {
          // Jika input kosong: tampilkan semua marker & zoom out agar semua kelihatan
          const bounds = L.latLngBounds([]);
          markers.forEach((item) => {
            item.marker.addTo(map);
            item.card.style.display = "block"; // Tampilkan semua card
            bounds.extend(item.marker.getLatLng());
          });
          map.fitBounds(bounds); // Zoom out agar semua marker terlihat
          updateRecordInfo(tugboats.length, tugboats.length);
          return;
        }

        let matchCount = 0;

        markers.forEach((item) => {
          if (item.id.toUpperCase().includes(searchTerm)) {
            item.marker.addTo(map).openPopup();
            item.card.style.display = "block";
            const fleetCard = item.card.querySelector(".fleet-card");
            fleetCard.classList.add("highlight");
            matchCount++;
          } else {
            item.card.style.display = "none";
          }
        });

        updateRecordInfo(matchCount, tugboats.length);

        if (!anyMatch) {
          map.setView([-3.1, 114.65], 9); // Default view kalau tidak ditemukan
        }

        const found = tugboats.find((tugboat) =>
          tugboat.id.includes(searchTerm)
        );
        if (found) {
          const result = markers.find((m) => m.id === found.id);
          result.marker.addTo(map).openPopup();

          const fleetCard = result.card.querySelector(".fleet-card");
          fleetCard.classList.add("highlight");

          fleetCard.scrollIntoView({ behavior: "smooth", block: "center" });
          map.setView(found.coords, 15);
        }
      });

      function updateRecordInfo(visibleCount, totalCount) {
        const recordInfo = document.getElementById("record-info");
        recordInfo.innerHTML = `<small>${visibleCount} records found</small><br /><strong>of ${totalCount} Tugboats</strong>`;
      }
    </script>
  </body>
</html>
